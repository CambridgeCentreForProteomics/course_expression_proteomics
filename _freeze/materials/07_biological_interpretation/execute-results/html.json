{
  "hash": "6fe03c32f46d08646cf54d50c322175d",
  "result": {
    "markdown": "---\ntitle: Biological interpretation\nbibliography: course_refs.bib\neditor_options: \n  chunk_output_type: console\n---\n\n\n::: {.callout-tip}\n#### Learning Objectives\n\n* Be aware of different analyses that can be done to gain a biological understanding of expression proteomics results\n* Understand the concept of Gene Ontology (GO) enrichment analyses \n* Complete GO enrichment analyses using the `enrichGO` function from the `clusterProfiler` package\n\n:::\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](figs/flow_chart/flow_chart.012.png){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\n\n## Adding metadata to our results using `dplyr`\n\nBefore we can look any further into the biological meaning of any protein \nabundance changes we need to extract these proteins from our overall results.\nIt is also useful to re-add information about the master protein descriptions\nsince this is lost in the output of `limma` analysis. \n\nIt is important to note that the results table we have generated from `limma`\nis not in the same order as the input data. Therefore, to add information from our\noriginal data e.g., from the `rowData` such as the `Master.Protein.Descriptions`\nwe must match the protein names between them. \n\nTo do this, let's extract information the `Master.Protein.Descriptions` from the original\ndata we have created called `all_proteins`. \n\nRecall that `all_proteins` is a `SummarizedExperiment` object,\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_proteins\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nclass: SummarizedExperiment \ndim: 3823 6 \nmetadata(0):\nassays(2): assay aggcounts\nrownames(3823): A0A0B4J2D5 A0A2R8Y4L2 ... Q9Y6X9 Q9Y6Y8\nrowData names(21): Checked Tags ... Protein.FDR.Confidence .n\ncolnames(6): M_1 M_2 ... G1_2 G1_3\ncolData names(4): sample rep condition tag\n```\n:::\n:::\n\n\nWe wish to extract information from the `rowData` regarding the\n`Master.Protein.Descriptions`,\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Add master protein descriptions back\nprotein_info <- all_proteins %>%\n  rowData() %>%\n  as_tibble() %>%\n  select(Protein = Master.Protein.Accessions, \n         Protein_description = Master.Protein.Descriptions)\n\nprotein_info %>% head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 2\n  Protein    Protein_description                                                \n  <chr>      <chr>                                                              \n1 A0A0B4J2D5 Putative glutamine amidotransferase-like class 1 domain-containing…\n2 A0A2R8Y4L2 Heterogeneous nuclear ribonucleoprotein A1-like 3 OS=Homo sapiens …\n3 A0AVT1     Ubiquitin-like modifier-activating enzyme 6 OS=Homo sapiens OX=960…\n4 A0MZ66     Shootin-1 OS=Homo sapiens OX=9606 GN=SHTN1 PE=1 SV=4               \n5 A1L0T0     2-hydroxyacyl-CoA lyase 2 OS=Homo sapiens OX=9606 GN=ILVBL PE=1 SV…\n6 A1X283     SH3 and PX domain-containing protein 2B OS=Homo sapiens OX=9606 GN…\n```\n:::\n:::\n\n\nNote, we also extract the `Master.Protein.Accessions` column so we can use\nthis to match to the `protein` column in our `limma` results.\n\nNow we can use the `left_join` function from `dplyr` to match the protein\ndescriptions to the protein IDs,\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlimma_results <- limma_results %>% \n  left_join(protein_info, by = \"Protein\", suffix = c(\".left\", \".right\"))\n\n# Verify\nlimma_results %>%\n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Protein     logFC   AveExpr         t      P.Value    adj.P.Val        B\n1  Q9NQW6 -2.077921  2.641270 -40.40812 1.139582e-15 4.356623e-12 25.79468\n2  Q9BW19 -2.343592  1.430210 -36.79774 4.073530e-15 7.786553e-12 24.71272\n3  P49454 -1.991326  2.598481 -34.88623 8.411188e-15 9.266757e-12 24.07905\n4  Q9ULW0 -2.152503  2.476087 -34.52309 9.695796e-15 9.266757e-12 23.95341\n5  Q562F6 -3.205603 -1.304111 -32.91865 1.849860e-14 1.414403e-11 23.37677\n6  O14965 -2.098029  0.797902 -31.22180 3.791132e-14 2.415583e-11 22.72604\n  direction significance\n1      down          sig\n2      down          sig\n3      down          sig\n4      down          sig\n5      down          sig\n6      down          sig\n                                                    Protein_description\n1                     Anillin OS=Homo sapiens OX=9606 GN=ANLN PE=1 SV=2\n2 Kinesin-like protein KIFC1 OS=Homo sapiens OX=9606 GN=KIFC1 PE=1 SV=2\n3       Centromere protein F OS=Homo sapiens OX=9606 GN=CENPF PE=1 SV=3\n4 Targeting protein for Xklp2 OS=Homo sapiens OX=9606 GN=TPX2 PE=1 SV=2\n5                 Shugoshin 2 OS=Homo sapiens OX=9606 GN=SGO2 PE=1 SV=2\n6            Aurora kinase A OS=Homo sapiens OX=9606 GN=AURKA PE=1 SV=3\n```\n:::\n:::\n\n\n::: {.callout-note}\n#### Manipulating data with `dplyr` and `tidyverse`\nThere is lots of information online about getting started with `dplyr` and\nusing the `tidyverse`. We really like [this lesson from the Data Carpentry](https://datacarpentry.org/R-ecology-lesson/03-dplyr.html) if\nyou are new to the `tidyverse`.\n\n:::\n\n## Subset differentially abundant proteins\n\nLet's subset our results and only keep proteins which have been flagged as \nexhibiting significant abundance changes, \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsig_changing <- limma_results %>% \n  as_tibble() %>%\n  filter(significance == \"sig\")\n\nsig_up <- sig_changing %>%\n  filter(direction == \"up\")\n\nsig_down <- sig_changing %>%\n  filter(direction == \"down\")\n```\n:::\n\n\n\n## Biological interpretation of differentially abundant proteins\n\nOur statistical analyses provided us with a list of proteins that are present\nwith significantly different abundances between M-phase and G1-phase of the cell \ncycle. We can get an initial idea about what these proteins are and do by \nlooking at the protein descriptions. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Look at descriptions of proteins upregulated in M relative to G1\nsig_up %>%\n  pull(Protein_description) %>%\n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Golgi reassembly-stacking protein 2 OS=Homo sapiens OX=9606 GN=GORASP2 PE=1 SV=3\"\n[2] \"Selenoprotein S OS=Homo sapiens OX=9606 GN=SELENOS PE=1 SV=3\"                    \n[3] \"Anamorsin OS=Homo sapiens OX=9606 GN=CIAPIN1 PE=1 SV=2\"                          \n[4] \"Krueppel-like factor 16 OS=Homo sapiens OX=9606 GN=KLF16 PE=1 SV=1\"              \n[5] \"Histone H1.10 OS=Homo sapiens OX=9606 GN=H1-10 PE=1 SV=1\"                        \n[6] \"Importin subunit alpha-4 OS=Homo sapiens OX=9606 GN=KPNA3 PE=1 SV=2\"             \n```\n:::\n:::\n\n\nWhilst we may recognise some of the changing proteins, this might be the first\ntime that we are coming across others. Moreover, some protein descriptions \ncontain useful information, but this is very limited. We still want to find out\nmore about the biological role of the statistically significant proteins so that\nwe can infer the potential effects of their abundance changes. \n\nThere are many functional analyses that could be done on the proteins with\ndifferential abundance:\n\n* Investigate the biological pathways that the proteins function within ([KEGG](https://www.genome.jp/kegg/) etc.)\n* Identify potential interacting partners ([IntAct](https://www.ebi.ac.uk/intact/), [STRING](https://string-db.org] etc.))\n* Determine the subcellular localisation in which the changing proteins are found \n* Understand the co-regulation of their mRNAs ([Expression Atlas](https://www.ebi.ac.uk/gxa))\n* Compare our changing proteins to those previously identified in other proteomic\nstudies of the cell cycle\n\n### Gene Ontology (GO) enrichment analysis \n\nOne of the common methods used to probe the biological relevance of proteins\nwith significant changes in abundance between conditions is to carry out Gene\nOntology (GO) enrichment, or over-representation, analysis.\n\nThe Gene Ontology consortium have defined a set of hierarchical descriptions to\nbe assigned to genes and their resulting proteins. These descriptions are split\ninto three categories: cellular components (CC), biological processes (BP) and\nmolecular function (MF). The idea is to provide information about a protein's\nsubcellular localisation, functionality and which processes it contributes to\nwithin the cell. Hence, the overarching aim of GO enrichment analysis is to\nanswer the question:\n\n*\"Given a list of proteins found to be differentially abundant in my phenotype of interest, what are the cellular components, molecular functions and biological processes involved in this phenotype?\".*\n\nUnfortunately, just looking at the GO terms associated with our differentially\nabundant proteins is insufficient to draw any solid conclusions. For example, if\nwe find that 120 of the 453 proteins significantly\ndownregulated in M phase are annotated with the GO term \"kinase activity\", it may\nseem intuitive to conclude that reducing kinase activity is important for the M-phase \nphenotype. However, if 90% of all proteins in the cell were kinases (an extreme\nexample), then we might expect to discover a high representation of the \"kinase\nactivity\" GO term in any protein list we end up with.\n\nThis leads us to the concept of an over-representation analysis. We wish to ask \nwhether any GO terms are over-represented (i.e., present at a higher frequency \nthan expected by chance) in our lists of differentially abundant proteins. In \nother words, we need to know how many proteins with a GO term *could* have\nshown differential abundance in our experiment vs. how many proteins with this\nGO term *did* show differential abundance in our experiment. \n\nWe are going to use a function in R called `enrichGO` from the the\n[`clusterProfiler`](https://bioconductor.org/packages/release/bioc/html/clusterProfiler.html)\n@Yu2012 Bioconductor R package to perform GO enrichment analysis. The package vignette \ncan be found\n[here](https://bioconductor.org/packages/release/bioc/vignettes/clusterProfiler/inst/doc/clusterProfiler.html).\nand full tutorials for using the package [here](https://yulab-smu.top/biomedical-knowledge-mining-book/index.html)\n\n::: {.callout-note}\n#### Annotation packages in Bioconductor\nThe `enrichGO` function uses the [`org.Hs.eg.db`](https://bioconductor.org/packages/release/data/annotation/html/org.Hs.eg.db.html) Bioconductor package that has\ngenome wide annotation for human. It also uses the [`GO.db`](`https://bioconductor.org/packages/release/data/annotation/html/GO.db.html`) package\nwhich is a set of annotation maps describing the entire Gene Ontology assembled using data from GO.\n\nUnfortunately, because GO annotations are by design at the gene level, performing analyses with proteomics data can be more tricky. \n\n:::\n\nIn the next code chunk we call the `enrichGO` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nego_down <- enrichGO(gene = sig_down$Protein,               # list of down proteins\n                     universe = limma_results$Protein,      # all proteins \n                     OrgDb = org.Hs.eg.db,                  # database to query\n                     keyType = \"UNIPROT\",                   # protein ID encoding \n                     qvalueCutoff = 0.05,\n                     ont = \"BP\",                            # can be CC, MF, BP, or ALL\n                     readable = TRUE)\n```\n:::\n\n\n\nLet's take a look at the output.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(ego_down@result)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   ID                                   Description GeneRatio\nGO:0030198 GO:0030198             extracellular matrix organization    24/443\nGO:0043062 GO:0043062          extracellular structure organization    24/443\nGO:0045229 GO:0045229 external encapsulating structure organization    24/443\nGO:0055085 GO:0055085                       transmembrane transport    61/443\nGO:0045333 GO:0045333                          cellular respiration    35/443\nGO:0030199 GO:0030199                  collagen fibril organization    13/443\n            BgRatio RichFactor FoldEnrichment   zScore       pvalue\nGO:0030198  52/3673  0.4615385       3.826706 7.601862 8.298786e-10\nGO:0043062  52/3673  0.4615385       3.826706 7.601862 8.298786e-10\nGO:0045229  52/3673  0.4615385       3.826706 7.601862 8.298786e-10\nGO:0055085 244/3673  0.2500000       2.072799 6.422166 5.339347e-09\nGO:0045333 107/3673  0.3271028       2.712074 6.655422 9.470160e-09\nGO:0030199  19/3673  0.6842105       5.672924 7.561939 1.326766e-08\n               p.adjust       qvalue\nGO:0030198 7.753832e-07 6.563320e-07\nGO:0043062 7.753832e-07 6.563320e-07\nGO:0045229 7.753832e-07 6.563320e-07\nGO:0055085 3.741547e-06 3.167076e-06\nGO:0045333 5.308972e-06 4.493840e-06\nGO:0030199 6.198208e-06 5.246545e-06\n                                                                                                                                                                                                                                                                                                                                                                                                                                 geneID\nGO:0030198                                                                                                                                                                                                                                                                      CCN1/QSOX1/COL12A1/ITGB1/SERPINH1/APP/LAMC1/PLOD2/COL23A1/P4HA1/FLOT1/LOXL2/COL4A2/FKBP10/PLOD1/MMP2/CRTAP/PRDX4/COLGALT1/PLOD3/TGFB2/ERO1A/COL1A1/DAG1\nGO:0043062                                                                                                                                                                                                                                                                      CCN1/QSOX1/COL12A1/ITGB1/SERPINH1/APP/LAMC1/PLOD2/COL23A1/P4HA1/FLOT1/LOXL2/COL4A2/FKBP10/PLOD1/MMP2/CRTAP/PRDX4/COLGALT1/PLOD3/TGFB2/ERO1A/COL1A1/DAG1\nGO:0045229                                                                                                                                                                                                                                                                      CCN1/QSOX1/COL12A1/ITGB1/SERPINH1/APP/LAMC1/PLOD2/COL23A1/P4HA1/FLOT1/LOXL2/COL4A2/FKBP10/PLOD1/MMP2/CRTAP/PRDX4/COLGALT1/PLOD3/TGFB2/ERO1A/COL1A1/DAG1\nGO:0055085 THBS1/ITGB1/HSPA5/RACGAP1/TOMM70/MAGT1/ATP5F1A/SLC3A2/ATP1B1/SLC39A14/SLC2A1/HSPD1/SLC29A1/TIMM50/HSPA9/ASPH/TIMM21/ITGAV/NDUFS2/AIFM1/USP9X/TMEM165/SLC12A2/NNT/FLNA/PEX14/AFG3L2/UQCRC1/SLC25A3/NDUFS7/RALBP1/YES1/ATP5F1B/ERO1A/ARPP19/FMR1/ABCB7/GHITM/MT-CO2/ATP2A2/GRPEL1/ATP2B1/SLC25A24/TIMM44/ATP1A1/ATP6AP2/LETM1/SLC7A1/GOPC/ATP5PB/RPS6KB1/NDUFB3/UQCRFS1/TOMM40/ACTN4/COX4I1/SLC30A1/PMPCB/NDUFB8/STXBP3/SLC1A5\nGO:0045333                                                                                                                                                                                                            PLEC/ATP5F1A/CS/SOD2/SDHA/ACO2/SHMT2/NDUFS2/NNT/NDUFB11/ETFA/MDH2/SDHB/SUCLA2/UQCRC1/UQCRC2/CDK1/NDUFS7/SUCLG2/ATP5F1B/GHITM/MT-CO2/DLST/DLD/OXA1L/IDH3A/ATP5PB/STOML2/NDUFB3/CAT/HCCS/UQCRFS1/PDHB/COX4I1/NDUFB8\nGO:0030199                                                                                                                                                                                                                                                                                                                                      COL12A1/SERPINH1/PLOD2/P4HA1/LOXL2/FKBP10/PLOD1/CRTAP/COLGALT1/PLOD3/TGFB2/ERO1A/COL1A1\n           Count\nGO:0030198    24\nGO:0043062    24\nGO:0045229    24\nGO:0055085    61\nGO:0045333    35\nGO:0030199    13\n```\n:::\n:::\n\n\nThe output of the `enrichGO` function is an object of class `enrichResult` that\ncontains the `ID` and `Description` of all enriched GO terms. There is also \ninformation about which `geneID`s from our significantly downregulated proteins \nare annotated with each of the enriched GO terms. Let's take a look at the \ndescriptions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nego_down$Description %>% \n  head(10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"extracellular matrix organization\"            \n [2] \"extracellular structure organization\"         \n [3] \"external encapsulating structure organization\"\n [4] \"transmembrane transport\"                      \n [5] \"cellular respiration\"                         \n [6] \"collagen fibril organization\"                 \n [7] \"cell adhesion\"                                \n [8] \"mitochondrial transmembrane transport\"        \n [9] \"cell division\"                                \n[10] \"aerobic respiration\"                          \n```\n:::\n:::\n\n\nThere is a long list because of the hierarchical nature of GO terms. The results\nof GO enrichment analysis can be visualised in many different ways. For a full\noverview of GO enrichment visualisation tools see [*Visualization of functional enrichment result*](https://yulab-smu.top/biomedical-knowledge-mining-book/enrichplot.html).\n\nHere, we'll use a 'dotplot' first\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- dotplot(ego_down, \n        x = \"Count\", \n        showCategory = 20, \n        font.size = 10,\n        label_format = 100,\n        color = \"p.adjust\")\n\nprint(p)\n```\n\n::: {.cell-output-display}\n![](07_biological_interpretation_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nThe dotplot gives a good overview of the over-representation results for the top GO terms, but it's not clear how much overlap there is between the proteins annotated with each term. For this, we can use an 'upset' plot. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nupsetplot(ego_down, n=10)\n```\n\n::: {.cell-output-display}\n![](07_biological_interpretation_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\nIt's usually informative to explore the proteins with the over-represented GO terms further. For this, we need to know which proteins have a particular GO term. This is where is gets a little more tricky, since we need to map between Uniprot IDs and Entrez gene IDs for this.\n\nWe start by using the `toTable` method to turn the UNIPROT map into a `data.frame`.\n\n::: {.cell}\n\n```{.r .cell-code}\n## Obtain a gene to protein mapping for the proteins in our QFeatures\n## org.Hs.egUNIPROT is part of org.Hs.eg.db\ng2p_map_df <- toTable(org.Hs.egUNIPROT) %>%\n  filter(uniprot_id %in% rownames(cc_qf[['log_norm_proteins']]))\n\n## Obtain the GO terms for each gene\ngo_submap <- org.Hs.egGO[g2p_map_df$gene_id]\n\n## Merge the gene to protein map and GO terms for\n## genes to get GO terms for proteins\np2go <- toTable(go_submap) %>%\n  left_join(g2p_map_df, by='gene_id')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in left_join(., g2p_map_df, by = \"gene_id\"): Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 33120 of `x` matches multiple rows in `y`.\nℹ Row 186 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n```\n:::\n:::\n\n\nNow we can visualise the proteins with a particular GO term. Here, we will use a heatmap to see the patterns in protein abundance differences between the conditions for a given GO term.\n\n::: callout-exercise\n#### Challenge: Plot a heatmap for the significant cell division proteins\n\n\n{{< level 2 >}} \n\n\n\nMake a heatmap with the protein abundances in all samples for those proteins with\n'cell division' GO annotation. You can use the `ego_down@result` `data.frame` to \nget the GO term for 'cell division', or, failing that, your favourite search engine.\nFor the heatmap plotting, you can refer back to the end of the previous session where we used `pheatmap`.\n\n- How does the protein abundance in the desyncronised cells compare to the M/G1 phases? How does this inform your interpretation?\n\n\n::: {.callout-answer collapse=\"true\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Get the GO ID for 'cell division'\ncell_division_go <- ego_down@result %>%\n  filter(Description=='cell division') %>%\n  rownames()\n\n## Get the Uniprot IDs for cell division annotated proteins\ncell_division_uniprot_ids <- p2go %>%\n  filter(go_id==cell_division_go) %>%\n  pull(uniprot_id) %>%\n  unique()\n\n## Extract quant data\nquant_data <- cc_qf[[\"log_norm_proteins\"]] %>% assay()\n\n## Plot heatmap\npheatmap(mat = quant_data, \n         scale = \"row\",\n         show_rownames = FALSE)\n```\n\n::: {.cell-output-display}\n![](07_biological_interpretation_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n\n```{.r .cell-code}\n## Extract quant data for the significant proteins\nquant_data_cd <- quant_data[intersect(sig_changing$Protein, cell_division_uniprot_ids), ]\n\n## Plot heatmap\npheatmap(mat = quant_data_cd, \n         scale = \"row\",\n         show_rownames = TRUE)\n```\n\n::: {.cell-output-display}\n![](07_biological_interpretation_files/figure-html/unnamed-chunk-14-2.png){width=672}\n:::\n:::\n\n\n:::\n\n:::\n\n\n\n\n::: {.callout-tip}\n#### Key Points\n\n- Gene ontology (GO) terms described the molecular function (MF), biological processes (BP) and cellular component (CC) of genes (and their protein products).\n- GO terms are hierarchical and generic. They do not relate to specific biological systems e.g., cell type or condition.\n- GO enrichment analysis aims to identify GO terms that are present in a list of proteins of interest (foreground) at a higher frequency than expected by chance based on their frequency in a background list of proteins (universe). The universe should be a list of all proteins included identified and quantified in your experiment.\n- The `enrichGO` function from the `clusterProfiler` package provides a convenient way to carry out reproducible GO enrichment analysis in R.\n- There are many ways to visualise the results from functional enrichment analyses. With GO terms in particular, it's important to consider the relationships between the gene sets we are testing for over-representation.\n- \n\n:::\n\n## References {-}\n",
    "supporting": [
      "07_biological_interpretation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}